import{_ as l,c as i,a as t,b as s,d as a,e,o as r,r as o}from"./app-lmuV3LLn.js";const u="/assets/bean-lifecycle-_76JD0RY.svg",d={},k={href:"https://docs.spring.io/spring-framework/docs/5.3.39/javadoc-api/org/springframework/beans/factory/BeanFactory.html",target:"_blank",rel:"noopener noreferrer"},m={href:"https://chaycao.github.io/2020/02/15/%E5%A6%82%E4%BD%95%E8%AE%B0%E5%BF%86Spring-Bean%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.html",target:"_blank",rel:"noopener noreferrer"},v={href:"https://www.cnblogs.com/semi-sub/p/13548479.html",target:"_blank",rel:"noopener noreferrer"};function b(g,n){const p=o("ExternalLinkIcon"),c=o("Badge");return r(),i("div",null,[n[4]||(n[4]=t('<p>Spring Bean 的生命周期涵盖了从实例化到销毁的完整过程，并提供了多个扩展点供开发者自定义逻辑。理解这些阶段和扩展点有助于更好地掌握 Spring 框架的核心机制。</p><p>Spring Bean 生命周期的主要阶段：</p><p><strong>org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory</strong>.<code>doCreateBean</code></p><ul><li><strong>实例化</strong>：<code>createBeanInstance</code></li><li><strong>属性赋值/填充</strong>：<code>populateBean</code></li><li><strong>初始化</strong>：<code>initializeBean</code><ul><li>Aware 接口回调：<code>invokeAwareMethods</code></li><li>BeanPostProcessor 前置处理：<code>applyBeanPostProcessorsBeforeInitialization</code></li><li>初始化：<code>invokeInitMethods</code></li><li>BeanPostProcessor 后置处理：<code>applyBeanPostProcessorsAfterInitialization</code></li></ul></li><li><strong>使用</strong></li><li><strong>销毁</strong>：<code>registerDisposableBeanIfNecessary</code></li></ul><p><img src="'+u+'" alt="Bean 的生命周期"></p><h2 id="_1-实例化-instantiation" tabindex="-1"><a class="header-anchor" href="#_1-实例化-instantiation"><span>1. 实例化（Instantiation）</span></a></h2><p>Spring 容器根据 Bean 的定义（如 XML 配置、注解或 Java 配置）创建 Bean 的实例。</p><p>如果 Bean 是通过构造函数注入依赖的，Spring 会解析并注入所需的依赖。</p><p>在 Spring 源码中，Bean 的实例化主要由 <code>AbstractAutowireCapableBeanFactory</code> 类的 <code>createBeanInstance</code> 方法实现。</p><h2 id="_2-属性赋值-populate-properties" tabindex="-1"><a class="header-anchor" href="#_2-属性赋值-populate-properties"><span>2. 属性赋值（Populate Properties）</span></a></h2><p>Spring 容器将配置的属性值或依赖注入到 Bean 中。</p><p>如果使用了自动装配（@Autowired 或 @Resource），Spring 会自动解析并注入依赖。</p><h2 id="_3-初始化-initialization" tabindex="-1"><a class="header-anchor" href="#_3-初始化-initialization"><span>3. 初始化（Initialization）</span></a></h2><p><code>org.springframework.beans.factory.BeanFactory</code> 的类注释中，描述了完整的初始化方法及其标准顺序。</p>',14)),s("p",null,[s("a",k,[n[0]||(n[0]=a("BeanFactory (Spring Framework 5.3.39 API)")),e(p)])]),s("p",null,[n[1]||(n[1]=a("spring-framework-")),e(c,{type:"tip",text:"v6.2.1",vertical:"middle"})]),n[5]||(n[5]=t(`<div class="custom-container info"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="9"></circle><path d="M12 8h.01"></path><path d="M11 12h1v4h1"></path></g></svg><p class="custom-container-title">BeanFactory 类的相关注释</p><p>Bean factory implementations should support the standard bean lifecycle interfaces as far as possible.<br> Bean 工厂的实现应尽可能支持标准的 Bean 生命周期接口。</p><p><strong>The full set of initialization methods and their standard order is:</strong><br> 完整的初始化方法及其标准顺序如下：</p><ol><li>⭐ BeanNameAware&#39;s <code>setBeanName</code></li><li>⭐ BeanClassLoaderAware&#39;s <code>setBeanClassLoader</code></li><li>⭐ BeanFactoryAware&#39;s <code>setBeanFactory</code></li><li>EnvironmentAware&#39;s <code>setEnvironment</code></li><li>EmbeddedValueResolverAware&#39;s <code>setEmbeddedValueResolver</code></li><li>ResourceLoaderAware&#39;s <code>setResourceLoader</code> (only applicable when running in an application context)</li><li>ApplicationEventPublisherAware&#39;s <code>setApplicationEventPublisher</code> (only applicable when running in an application context)</li><li>MessageSourceAware&#39;s <code>setMessageSource</code> (only applicable when running in an application context)</li><li>ApplicationContextAware&#39;s <code>setApplicationContext</code> (only applicable when running in an application context)</li><li>ServletContextAware&#39;s <code>setServletContext</code> (only applicable when running in an application context)</li><li>⭐ <code>postProcessBeforeInitialization</code> methods of BeanPostProcessors</li><li>⭐ InitializingBean&#39;s <code>afterPropertiesSet</code></li><li>⭐ a custom <code>init-method</code> definition</li><li>⭐ <code>postProcessAfterInitialization</code> methods of BeanPostProcessors</li></ol><p><strong>On shutdown of a bean factory, the following lifecycle methods apply:</strong></p><ol><li><code>postProcessBeforeDestruction</code> methods of DestructionAwareBeanPostProcessors</li><li>⭐ DisposableBean&#39;s <code>destroy</code></li><li>⭐ a custom <code>destroy-method</code> definition</li></ol><p><strong>See Also</strong>:</p><ul><li>⭐ <code>BeanNameAware.</code> setBeanName,</li><li>⭐ <code>BeanClassLoaderAware.</code> setBeanClassLoader,</li><li>⭐ <code>BeanFactoryAware.</code> setBeanFactory,</li><li><code>org. springframework. context. EnvironmentAware.</code> setEnvironment,</li><li><code>org. springframework. context. EmbeddedValueResolverAware.</code> setEmbeddedValueResolver,</li><li><code>org. springframework. context. ResourceLoaderAware.</code> setResourceLoader,</li><li><code>org. springframework. context. ApplicationEventPublisherAware.</code> setApplicationEventPublisher,</li><li><code>org. springframework. context. MessageSourceAware.</code> setMessageSource,</li><li><code>org. springframework. context. ApplicationContextAware.</code> setApplicationContext,</li><li><code>org. springframework. web. context. ServletContextAware.</code> setServletContext,</li><li>⭐ <code>org. springframework. beans. factory. config. BeanPostProcessor.</code> postProcessBeforeInitialization,</li><li>⭐ <code>InitializingBean.</code> afterPropertiesSet,</li><li><code>org. springframework. beans. factory. support. RootBeanDefinition.</code> getInitMethodName,</li><li>⭐ <code>org. springframework. beans. factory. config. BeanPostProcessor.</code> postProcessAfterInitialization,</li><li><code>org. springframework. beans. factory. config. DestructionAwareBeanPostProcessor.</code> postProcessBeforeDestruction,</li><li>⭐ <code>DisposableBean.</code> destroy,</li><li><code>org. springframework. beans. factory. support. RootBeanDefinition.</code> getDestroyMethodName</li></ul></div><h3 id="_3-1-aware-接口回调-aware-interfaces" tabindex="-1"><a class="header-anchor" href="#_3-1-aware-接口回调-aware-interfaces"><span>3.1. Aware 接口回调（Aware Interfaces）</span></a></h3><p>若 Bean 实现了特定 Aware 接口，容器会回调相关方法。</p><p>常见接口：</p><p>BeanNameAware：设置 Bean 的名称。</p><p>BeanFactoryAware：设置 Bean 的工厂实例。</p><p>ApplicationContextAware：设置应用上下文（需注意耦合性）。</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">invokeAwareMethods</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">Object</span> bean<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>bean <span class="token keyword">instanceof</span> <span class="token class-name">Aware</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>bean <span class="token keyword">instanceof</span> <span class="token class-name">BeanNameAware</span> beanNameAware<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      beanNameAware<span class="token punctuation">.</span><span class="token function">setBeanName</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>bean <span class="token keyword">instanceof</span> <span class="token class-name">BeanClassLoaderAware</span> beanClassLoaderAware<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token class-name">ClassLoader</span> bcl <span class="token operator">=</span> <span class="token function">getBeanClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">if</span> <span class="token punctuation">(</span>bcl <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        beanClassLoaderAware<span class="token punctuation">.</span><span class="token function">setBeanClassLoader</span><span class="token punctuation">(</span>bcl<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>bean <span class="token keyword">instanceof</span> <span class="token class-name">BeanFactoryAware</span> beanFactoryAware<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      beanFactoryAware<span class="token punctuation">.</span><span class="token function">setBeanFactory</span><span class="token punctuation">(</span><span class="token class-name">AbstractAutowireCapableBeanFactory</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-beanpostprocessor-前置处理" tabindex="-1"><a class="header-anchor" href="#_3-2-beanpostprocessor-前置处理"><span>3.2. BeanPostProcessor 前置处理</span></a></h3><p>描述：调用 BeanPostProcessor.postProcessBeforeInitialization()。</p><p>如果容器中注册了 BeanPostProcessor，Spring 会调用其 postProcessBeforeInitialization 方法。</p><p>这是一个扩展点，允许在 Bean 初始化之前对 Bean 进行自定义处理。</p><p>典型应用：</p><p>修改 Bean 属性（如替换字符串占位符）。</p><p>生成代理对象（AOP 在此阶段介入）。</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Deprecated</span><span class="token punctuation">(</span>since <span class="token operator">=</span> <span class="token string">&quot;6.1&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token annotation punctuation">@Override</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">applyBeanPostProcessorsBeforeInitialization</span><span class="token punctuation">(</span><span class="token class-name">Object</span> existingBean<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">  <span class="token class-name">Object</span> result <span class="token operator">=</span> existingBean<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">BeanPostProcessor</span> processor <span class="token operator">:</span> <span class="token function">getBeanPostProcessors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">Object</span> current <span class="token operator">=</span> processor<span class="token punctuation">.</span><span class="token function">postProcessBeforeInitialization</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>current <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">return</span> result<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    result <span class="token operator">=</span> current<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">return</span> result<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-初始化-initialization" tabindex="-1"><a class="header-anchor" href="#_3-3-初始化-initialization"><span>3.3. 初始化（Initialization）</span></a></h3><p>InitializingBean 接口：如果 Bean 实现了 InitializingBean 接口，Spring 会调用其 afterPropertiesSet 方法。</p><p>自定义初始化方法：如果 Bean 定义了自定义的初始化方法（通过 @PostConstruct 注解或 XML 配置中的 init-method 属性），Spring 会调用该方法。</p><p>顺序：</p><p>@PostConstruct 注解方法：通过反射调用。</p><p>InitializingBean.afterPropertiesSet()：接口回调。</p><p>自定义 init-method：XML 或 @Bean(initMethod=&quot;...&quot;) 定义的方法。</p><p>目标：执行资源初始化（如数据库连接池、线程池）。</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">invokeInitMethods</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">Object</span> bean<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">RootBeanDefinition</span> mbd<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">boolean</span> isInitializingBean <span class="token operator">=</span> <span class="token punctuation">(</span>bean <span class="token keyword">instanceof</span> <span class="token class-name">InitializingBean</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>isInitializingBean <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>mbd <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token operator">!</span>mbd<span class="token punctuation">.</span><span class="token function">hasAnyExternallyManagedInitMethod</span><span class="token punctuation">(</span><span class="token string">&quot;afterPropertiesSet&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isTraceEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      logger<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">&quot;Invoking afterPropertiesSet() on bean with name &#39;&quot;</span> <span class="token operator">+</span> beanName <span class="token operator">+</span> <span class="token string">&quot;&#39;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">InitializingBean</span><span class="token punctuation">)</span> bean<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">afterPropertiesSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [!code highlight]</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>mbd <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> bean<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token class-name">NullBean</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> initMethodNames <span class="token operator">=</span> mbd<span class="token punctuation">.</span><span class="token function">getInitMethodNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>initMethodNames <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> initMethodName <span class="token operator">:</span> initMethodNames<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasLength</span><span class="token punctuation">(</span>initMethodName<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span></span>
<span class="line">            <span class="token operator">!</span><span class="token punctuation">(</span>isInitializingBean <span class="token operator">&amp;&amp;</span> <span class="token string">&quot;afterPropertiesSet&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>initMethodName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span></span>
<span class="line">            <span class="token operator">!</span>mbd<span class="token punctuation">.</span><span class="token function">hasAnyExternallyManagedInitMethod</span><span class="token punctuation">(</span>initMethodName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token function">invokeCustomInitMethod</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> bean<span class="token punctuation">,</span> mbd<span class="token punctuation">,</span> initMethodName<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-4-beanpostprocessor-后置处理" tabindex="-1"><a class="header-anchor" href="#_3-4-beanpostprocessor-后置处理"><span>3.4. BeanPostProcessor 后置处理</span></a></h3><p>描述：调用 BeanPostProcessor.postProcessAfterInitialization()。</p><p>Spring 调用 BeanPostProcessor 的 postProcessAfterInitialization 方法。</p><p>这是另一个扩展点，允许在 Bean 初始化之后对 Bean 进行自定义处理。</p><p>典型应用：</p><p>进一步包装 Bean（如生成最终代理对象）。</p><p>添加监控或日志逻辑。</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Deprecated</span><span class="token punctuation">(</span>since <span class="token operator">=</span> <span class="token string">&quot;6.1&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token annotation punctuation">@Override</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">applyBeanPostProcessorsAfterInitialization</span><span class="token punctuation">(</span><span class="token class-name">Object</span> existingBean<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">  <span class="token class-name">Object</span> result <span class="token operator">=</span> existingBean<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">BeanPostProcessor</span> processor <span class="token operator">:</span> <span class="token function">getBeanPostProcessors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">Object</span> current <span class="token operator">=</span> processor<span class="token punctuation">.</span><span class="token function">postProcessAfterInitialization</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>current <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">return</span> result<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    result <span class="token operator">=</span> current<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">return</span> result<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-bean-就绪-ready" tabindex="-1"><a class="header-anchor" href="#_4-bean-就绪-ready"><span>4. Bean 就绪（Ready）</span></a></h2><p>描述：Bean 进入可用状态，供其他对象使用。</p><p>Bean 的使用 此时 Bean 已经完全初始化，可以被应用程序使用。</p><p>Bean 会被缓存到 Spring 容器中，后续请求会直接返回缓存的实例（如果是单例作用域）。</p><h2 id="_5-销毁-destruction" tabindex="-1"><a class="header-anchor" href="#_5-销毁-destruction"><span>5. 销毁（Destruction）</span></a></h2><p>当 Spring 容器关闭时，Bean 会进入销毁阶段。</p><p>DisposableBean 接口：如果 Bean 实现了 DisposableBean 接口，Spring 会调用其 destroy 方法。</p><p>自定义销毁方法：如果 Bean 定义了自定义的销毁方法（通过 @PreDestroy 注解或 XML 配置中的 destroy-method 属性），Spring 会调用该方法。</p><p>触发条件：容器关闭（如调用 ApplicationContext.close()）。</p><p>顺序：</p><p>@PreDestroy 注解方法：通过反射调用。</p><p>DisposableBean.destroy()：接口回调。</p><p>自定义 destroy-method：XML 或 @Bean(destroyMethod=&quot;...&quot;) 定义的方法。</p><p>目标：释放资源（如关闭文件句柄、断开网络连接）。</p><h2 id="_6-源码分析" tabindex="-1"><a class="header-anchor" href="#_6-源码分析"><span>6. 源码分析</span></a></h2><p><code>org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory</code> 实现了 Bean 的创建、依赖注入、初始化等核心功能。作为 <code>AbstractBeanFactory</code> 的子类，它扩展了 Bean 的创建和装配能力，并实现了 <code>AutowireCapableBeanFactory</code> 接口，支持自动装配功能。</p><div class="custom-container info"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="9"></circle><path d="M12 8h.01"></path><path d="M11 12h1v4h1"></path></g></svg><p class="custom-container-title">类注释</p><p>Provides bean creation (with constructor resolution), property population, wiring (including autowiring), and initialization. Handles runtime bean references, resolves managed collections, calls initialization methods, etc. Supports autowiring constructors, properties by name, and properties by type.</p><p>该抽象类提供了Bean的创建（包括构造函数解析）、属性填充、依赖注入（包括自动装配）以及初始化等功能。它能够处理运行时Bean引用、解析托管集合、调用初始化方法等。此外，它还支持通过构造函数、按名称和按类型进行自动装配。</p></div><h3 id="_6-1-类的作用" tabindex="-1"><a class="header-anchor" href="#_6-1-类的作用"><span>6.1. 类的作用</span></a></h3><p><code>AbstractAutowireCapableBeanFactory</code> 是 Spring 容器中用于创建和管理 Bean 的核心类之一。它提供了以下功能：</p><ul><li><strong>Bean 的实例化</strong>：通过构造函数或工厂方法创建 Bean 实例。</li><li><strong>属性注入</strong>：支持通过 setter 方法或字段注入依赖。</li><li><strong>自动装配</strong>：支持按名称、类型或构造函数自动装配依赖。</li><li><strong>初始化回调</strong>：支持 <code>InitializingBean</code>、<code>@PostConstruct</code> 和自定义初始化方法。</li><li><strong>销毁回调</strong>：支持 <code>DisposableBean</code>、<code>@PreDestroy</code> 和自定义销毁方法。</li></ul><h3 id="_6-2-核心方法分析" tabindex="-1"><a class="header-anchor" href="#_6-2-核心方法分析"><span>6.2. 核心方法分析</span></a></h3><p>以下是核心方法的简化逻辑：</p><h4 id="_1-createbean-方法" tabindex="-1"><a class="header-anchor" href="#_1-createbean-方法"><span>(1) <code>createBean</code> 方法</span></a></h4><p>这是创建 Bean 的核心方法，负责 Bean 的实例化、属性填充、初始化等操作。</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Override</span></span>
<span class="line"><span class="token keyword">protected</span> <span class="token class-name">Object</span> <span class="token function">createBean</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">RootBeanDefinition</span> mbd<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">throws</span> <span class="token class-name">BeanCreationException</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 1. 解析 Bean 的 Class 类型</span></span>
<span class="line">    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> resolvedClass <span class="token operator">=</span> <span class="token function">resolveBeanClass</span><span class="token punctuation">(</span>mbd<span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>resolvedClass <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>mbd<span class="token punctuation">.</span><span class="token function">hasBeanClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        mbd<span class="token punctuation">.</span><span class="token function">setBeanClass</span><span class="token punctuation">(</span>resolvedClass<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 2. 处理 Bean 的覆盖定义（如 lookup-method 和 replace-method）</span></span>
<span class="line">    <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">        mbd<span class="token punctuation">.</span><span class="token function">prepareMethodOverrides</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">BeanDefinitionValidationException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BeanDefinitionStoreException</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 3. 调用 BeanPostProcessor 的前置处理方法</span></span>
<span class="line">    <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">Object</span> bean <span class="token operator">=</span> <span class="token function">resolveBeforeInstantiation</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> mbd<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>bean <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> bean<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BeanCreationException</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 4. 真正创建 Bean 的实例</span></span>
<span class="line">    <span class="token class-name">Object</span> beanInstance <span class="token operator">=</span> <span class="token function">doCreateBean</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> mbd<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> beanInstance<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-docreatebean-方法" tabindex="-1"><a class="header-anchor" href="#_2-docreatebean-方法"><span>(2) <strong><code>doCreateBean</code> 方法</strong></span></a></h4><p>这是实际创建 Bean 实例的方法，包括实例化、属性填充、初始化等步骤。</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">protected</span> <span class="token class-name">Object</span> <span class="token function">doCreateBean</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">RootBeanDefinition</span> mbd<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">throws</span> <span class="token class-name">BeanCreationException</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 1. 实例化 Bean</span></span>
<span class="line">    <span class="token class-name">BeanWrapper</span> instanceWrapper <span class="token operator">=</span> <span class="token function">createBeanInstance</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> mbd<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">Object</span> bean <span class="token operator">=</span> instanceWrapper<span class="token punctuation">.</span><span class="token function">getWrappedInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 2. 属性填充</span></span>
<span class="line">    <span class="token function">populateBean</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> mbd<span class="token punctuation">,</span> instanceWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 3. 初始化 Bean</span></span>
<span class="line">    bean <span class="token operator">=</span> <span class="token function">initializeBean</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> bean<span class="token punctuation">,</span> mbd<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 4. 注册销毁回调</span></span>
<span class="line">    <span class="token function">registerDisposableBeanIfNecessary</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> bean<span class="token punctuation">,</span> mbd<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">return</span> bean<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-createbeaninstance-方法" tabindex="-1"><a class="header-anchor" href="#_3-createbeaninstance-方法"><span>(3) <code>createBeanInstance</code> 方法</span></a></h4><p>负责创建 Bean 的实例，支持通过构造函数、工厂方法等方式实例化 Bean。</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">protected</span> <span class="token class-name">BeanWrapper</span> <span class="token function">createBeanInstance</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">RootBeanDefinition</span> mbd<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 1. 解析 Bean 的 Class 类型</span></span>
<span class="line">    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> beanClass <span class="token operator">=</span> <span class="token function">resolveBeanClass</span><span class="token punctuation">(</span>mbd<span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 2. 使用工厂方法创建 Bean</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>mbd<span class="token punctuation">.</span><span class="token function">getFactoryMethodName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token function">instantiateUsingFactoryMethod</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> mbd<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 3. 使用构造函数创建 Bean</span></span>
<span class="line">    <span class="token class-name">Constructor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> ctors <span class="token operator">=</span> <span class="token function">determineConstructorsFromBeanPostProcessors</span><span class="token punctuation">(</span>beanClass<span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>ctors <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">||</span> mbd<span class="token punctuation">.</span><span class="token function">getResolvedAutowireMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">AUTOWIRE_CONSTRUCTOR</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token function">autowireConstructor</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> mbd<span class="token punctuation">,</span> ctors<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 4. 使用默认构造函数创建 Bean</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">instantiateBean</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> mbd<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-populatebean-方法" tabindex="-1"><a class="header-anchor" href="#_4-populatebean-方法"><span>(4) <strong><code>populateBean</code> 方法</strong></span></a></h4><p>负责填充 Bean 的属性，支持自动装配和手动注入。</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">populateBean</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">RootBeanDefinition</span> mbd<span class="token punctuation">,</span> <span class="token class-name">BeanWrapper</span> bw<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 1. 获取 Bean 的属性值</span></span>
<span class="line">    <span class="token class-name">PropertyValues</span> pvs <span class="token operator">=</span> <span class="token punctuation">(</span>mbd<span class="token punctuation">.</span><span class="token function">hasPropertyValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> mbd<span class="token punctuation">.</span><span class="token function">getPropertyValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 2. 自动装配属性</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>mbd<span class="token punctuation">.</span><span class="token function">getResolvedAutowireMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">AUTOWIRE_BY_NAME</span> <span class="token operator">||</span> mbd<span class="token punctuation">.</span><span class="token function">getResolvedAutowireMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">AUTOWIRE_BY_TYPE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">MutablePropertyValues</span> newPvs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MutablePropertyValues</span><span class="token punctuation">(</span>pvs<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>mbd<span class="token punctuation">.</span><span class="token function">getResolvedAutowireMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">AUTOWIRE_BY_NAME</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token function">autowireByName</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> mbd<span class="token punctuation">,</span> bw<span class="token punctuation">,</span> newPvs<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>mbd<span class="token punctuation">.</span><span class="token function">getResolvedAutowireMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">AUTOWIRE_BY_TYPE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token function">autowireByType</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> mbd<span class="token punctuation">,</span> bw<span class="token punctuation">,</span> newPvs<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        pvs <span class="token operator">=</span> newPvs<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 3. 应用属性值</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>pvs <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">applyPropertyValues</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> mbd<span class="token punctuation">,</span> bw<span class="token punctuation">,</span> pvs<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-initializebean-方法" tabindex="-1"><a class="header-anchor" href="#_5-initializebean-方法"><span>(5) <strong><code>initializeBean</code> 方法</strong></span></a></h4><p>负责 Bean 的初始化，包括调用 <code>BeanPostProcessor</code>、<code>InitializingBean</code> 和自定义初始化方法。</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">protected</span> <span class="token class-name">Object</span> <span class="token function">initializeBean</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">Object</span> bean<span class="token punctuation">,</span> <span class="token class-name">RootBeanDefinition</span> mbd<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 1. 调用 Aware 方法（如 BeanNameAware、BeanFactoryAware）</span></span>
<span class="line">    <span class="token function">invokeAwareMethods</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> bean<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 2. 调用 BeanPostProcessor 的前置处理方法</span></span>
<span class="line">    <span class="token class-name">Object</span> wrappedBean <span class="token operator">=</span> bean<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>mbd <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token operator">!</span>mbd<span class="token punctuation">.</span><span class="token function">isSynthetic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        wrappedBean <span class="token operator">=</span> <span class="token function">applyBeanPostProcessorsBeforeInitialization</span><span class="token punctuation">(</span>wrappedBean<span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 3. 调用初始化方法</span></span>
<span class="line">    <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">invokeInitMethods</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> wrappedBean<span class="token punctuation">,</span> mbd<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BeanCreationException</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 4. 调用 BeanPostProcessor 的后置处理方法</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>mbd <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token operator">!</span>mbd<span class="token punctuation">.</span><span class="token function">isSynthetic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        wrappedBean <span class="token operator">=</span> <span class="token function">applyBeanPostProcessorsAfterInitialization</span><span class="token punctuation">(</span>wrappedBean<span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">return</span> wrappedBean<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>关键扩展点</p><ul><li><code>BeanPostProcessor</code>：允许在 Bean 初始化前后插入自定义逻辑。常用于修改 Bean 的属性或代理 Bean。</li><li><code>InitializingBean</code> 和 <code>DisposableBean</code>：提供初始化和销毁的回调方法。</li><li><code>@PostConstruct</code> 和 <code>@PreDestroy</code>：注解方式的初始化和销毁回调。</li><li><strong>Aware 接口</strong>：如 <code>BeanNameAware</code>、<code>ApplicationContextAware</code> 等，允许 Bean 获取 Spring 容器中的相关信息。</li></ul><p>其他相关类：</p><ul><li>org.springframework.beans.factory.config.BeanPostProcessor</li><li>org.springframework.beans.factory.InitializingBean</li><li>org.springframework.beans.factory.DisposableBean</li><li>org.springframework.context.ApplicationContextAware</li><li>org.springframework.context.support.ApplicationContextAwareProcessor</li><li>循环依赖：org.springframework.beans.factory.support.DefaultSingletonBeanRegistry</li></ul><h2 id="参考" tabindex="-1"><a class="header-anchor" href="#参考"><span>参考</span></a></h2>`,75)),s("p",null,[s("a",m,[n[2]||(n[2]=a("如何记忆Spring Bean的生命周期")),e(p)])]),s("p",null,[s("a",v,[n[3]||(n[3]=a("Spring 为何需要三级缓存解决循环依赖，而不是二级缓存")),e(p)])])])}const h=l(d,[["render",b],["__file","spring-bean-lifecycle.html.vue"]]),B=JSON.parse('{"path":"/series/tech/framework/spring/spring-bean-lifecycle.html","title":"Bean 的生命周期","lang":"en-US","frontmatter":{"title":"Bean 的生命周期"},"headers":[{"level":2,"title":"1. 实例化（Instantiation）","slug":"_1-实例化-instantiation","link":"#_1-实例化-instantiation","children":[]},{"level":2,"title":"2. 属性赋值（Populate Properties）","slug":"_2-属性赋值-populate-properties","link":"#_2-属性赋值-populate-properties","children":[]},{"level":2,"title":"3. 初始化（Initialization）","slug":"_3-初始化-initialization","link":"#_3-初始化-initialization","children":[{"level":3,"title":"3.1. Aware 接口回调（Aware Interfaces）","slug":"_3-1-aware-接口回调-aware-interfaces","link":"#_3-1-aware-接口回调-aware-interfaces","children":[]},{"level":3,"title":"3.2. BeanPostProcessor 前置处理","slug":"_3-2-beanpostprocessor-前置处理","link":"#_3-2-beanpostprocessor-前置处理","children":[]},{"level":3,"title":"3.3. 初始化（Initialization）","slug":"_3-3-初始化-initialization","link":"#_3-3-初始化-initialization","children":[]},{"level":3,"title":"3.4. BeanPostProcessor 后置处理","slug":"_3-4-beanpostprocessor-后置处理","link":"#_3-4-beanpostprocessor-后置处理","children":[]}]},{"level":2,"title":"4. Bean 就绪（Ready）","slug":"_4-bean-就绪-ready","link":"#_4-bean-就绪-ready","children":[]},{"level":2,"title":"5. 销毁（Destruction）","slug":"_5-销毁-destruction","link":"#_5-销毁-destruction","children":[]},{"level":2,"title":"6. 源码分析","slug":"_6-源码分析","link":"#_6-源码分析","children":[{"level":3,"title":"6.1. 类的作用","slug":"_6-1-类的作用","link":"#_6-1-类的作用","children":[]},{"level":3,"title":"6.2. 核心方法分析","slug":"_6-2-核心方法分析","link":"#_6-2-核心方法分析","children":[]}]},{"level":2,"title":"参考","slug":"参考","link":"#参考","children":[]}],"git":{"createdTime":1738460491000,"updatedTime":1748218348000,"contributors":[{"name":"柒月廿三","email":"lxang723@163.com","commits":3}]},"filePathRelative":"series/tech/framework/spring/spring-bean-lifecycle.md"}');export{h as comp,B as data};
