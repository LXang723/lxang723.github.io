---
title: Java 反射 
---

## 1. 什么是反射

关键字：运行时、动态的。

反射（Reflection）是 Java 编程语言的一个重要特性，它允许程序在运行时查看任意对象所属的类，获取类的内部信息（包括构造器、字段和方法等），并能动态地调用对象的方法或构造器。反射机制主要依赖于 `java.lang.reflect` 包中的类和接口，这些类和接口提供了丰富的 API 来操作类、接口、字段、方法和构造器等。

Java 的反射机制是一个强大的功能，使得程序能够在运行时动态地与类和对象交互。
这包括但不限于创建对象、访问字段和调用方法，这对于开发灵活的应用程序和构建复杂的框架至关重要。

> 《Java 核心技术 卷 Ⅰ》P290：第8章 泛型程序设计 8.9 反射和泛型  
> 反射允许你在运行时分析任意对象。如果对象是泛型类的实例，关于泛型类型参数，你可能得不到多少信息，因为它们已经被擦除了。

## 2. 反射的主要功能

Java 反射机制可以完成以下主要功能：

1. **在运行时判断任意一个对象所属的类**：通过反射，可以在运行时获取对象的类信息，包括类名、父类、接口等。
2. **在运行时构造任意一个类的对象**：通过反射，可以动态地创建类的实例，而无需在编译期知道具体的类名（例如，类名可以从配置文件、数据库中读取）。
3. **在运行时得到任意一个类所具有的成员和方法**：反射机制允许程序在运行时获取类的字段、方法、构造器等信息。
4. **在运行时调用任意一个对象的成员和方法**：通过反射，可以动态地调用对象的方法，包括私有方法（通过 `setAccessible(true)` 方法设置访问权限）。
5. **生成动态代理**：反射机制是动态代理实现的基础，通过反射可以创建代理对象，并在运行时动态地处理方法的调用。

## 3. 反射的相关类

Java反射机制涉及的主要类包括：

1. **java.lang.Class**：代表一个类，Class 对象表示某个类加载后在堆中的对象。它提供了获取类的字段、方法、构造函数等信息的方法。
2. **java.lang.reflect.Field**：代表类的成员变量（属性）。它提供了**访问和修改字段**的能力，包括私有字段（通过 `setAccessible(true)` 方法设置访问权限）。
3. **java.lang.reflect.Method**：代表类的方法。它提供了**调用方法**的能力，包括私有方法（同样需要设置访问权限）。
4. **java.lang.reflect.Constructor**：代表类的构造函数。它提供了**创建对象**的能力。

## 4. 反射的使用方式

使用反射通常需要遵循以下步骤：

1. **获取 Class 对象**：首先，需要获取目标类的Class对象。这可以通过多种方式实现，如通过类字面量、对象实例的 `getClass()` 方法、`Class.forName()` 方法等。
2. **获取成员信息**：通过Class对象，可以获取类的字段、方法、构造函数等信息。这些信息通常以数组的形式返回，包含类的所有公共成员或声明的成员（包括私有成员）。
3. **操作成员**：通过反射API，可以读取和修改字段的值、调用方法以及创建对象。对于私有成员和方法，需要设置访问权限（`setAccessible(true)`）。

## 5. 反射的优缺点及应用场景

#### 优点：

1. **灵活性和可扩展性**：反射机制允许程序在运行时动态地加载和使用类，提高了代码的灵活性和可扩展性。
2. **框架支持**：很多框架和库都广泛使用了反射机制，如 Spring 框架的依赖注入、JUnit 测试框架的注解处理等。

#### 缺点：

1. **性能开销**：反射机制相比直接调用方法有一定的性能开销，因为它需要在运行时进行类型检查和权限校验等操作。
2. **安全性问题**：反射机制可以访问类的私有属性和方法，这可能会破坏封装性并导致安全问题。因此，在使用反射时应确保代码的安全性。
3. **可读性和可维护性问题**：过度使用反射可能会使代码变得复杂和难以阅读和维护。因此，在使用反射时应权衡其带来的好处和代价。

#### 应用场景：

1. **动态加载和配置类**：在运行时根据需要动态地加载和配置类，提高代码的灵活性。
2. **动态代理**：通过反射机制实现动态代理，用于 AOP（面向切面编程）等场景。
3. **框架和库的实现**：很多框架和库都使用了反射机制来实现其功能，如 Spring 框架的依赖注入、Hibernate 的 ORM 映射等。

## 6. 示例代码

## 7. 推荐链接

- 视频：[AlbertShen：Java 中的反射 Reflection in Java](https://www.bilibili.com/video/BV1K4421w7zP)
- [JavaGuide：Java 反射机制详解](https://javaguide.cn/java/basis/reflection.html)
- [面试鸭：你使用过 Java 的反射机制吗？如何应用反射？](https://www.mianshiya.com/bank/1787463103423897602/question/1780933294611787778)
- [博客园：大白话说Java反射：入门、使用、原理](https://www.cnblogs.com/chanshuyi/p/head_first_of_reflection.html)